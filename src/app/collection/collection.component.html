<h1>Les histoires de Fifi et Rhino</h1>

<div class="card">
  <span *ngIf="showAbout">
    <p>Ce site est un recueil d'histoires pour enfants écrites avec le moteur GPT-3.5 Turbo d'<a href="https://openai.com/">OpenAI</a>.</p>
    <p>Il raconte les histoires de deux personnages inventés pour mes filles Agathe et Zoé : Fifi la girafe et Rhino le rhinocéros, dont les aventures sont imaginées par elles à peu près tous les soirs à partir d'une simple phrase à écrire ensemble :</p>
      <p>"fifi et rhino vont quelque part pour faire quelque chose (avec quelqu'un en option).".</p>
    <p>L'I.A fait le reste, y compris les illustrations.</p>
      <p>Les histoires sont lues par une autre I.A <a href="https://aws.amazon.com/fr/polly/">AWS Polly</a> pour les plus jeunes et propose un suivi de lecture (mot prononcé en surbrillance) pour une aide à la lecture des un peu moins jeunes.</p>
      <p>J'ai fait ce site pour expérimenter à titre personnel sur les nouveaux modèles d'Intelligence Artificielle appliqués à la création de contenu pédagogique et je souhaitais partager publiquement le résultat.</p>
      <p>Merci de votre visite et si vous être intéressés par cette expérience ou avez des suggestions d'améliorations, n'hésitez pas à m'envoyer un email à <a href="mailto:elsiokun+fifi@gmail.com">elsiokun+fifi@gmail.com</a></p>
  </span>
  <button (click)="about()" >
    {{aboutLabel}}
  </button>
  <button (click)="getStories()" >
    Actualiser les Histoires
  </button>
  <button (click)="gotoStories()">Créer une nouvelle histoire</button>
  <button *ngIf="login && admin" (click)="gotoAdmin()">Administrer</button>
</div>

<div *ngIf="storyBookLoading">
  <div *ngIf="storyBookLoading" id="loading"></div>
</div>

<div id="top" class="container" *ngIf="storyBookLoaded">
  <span class="menu"><a class="nav" (click)="previousPage()"><</a>
  <ul class="image-gallery">
    <li *ngFor="let story of currentpage; let i = index">
      <img src="{{ story.image }}" />
      <div class="overlay" (click)="setCurrStory(pageIndex*STORIES_PER_PAGE + i)">
        <span class="legend">
          Fifi et Rhino vont {{ story.location }} pour
          {{ story.purpose }}
          <span *ngIf="story?.companion"
            >avec {{ story.companion }}</span
          >
        </span>
      </div>
    </li>
  </ul>
  <a class="nav" (click)="nextPage()">></a>
</span>
</div>

<div class="card">
  <button (click)="previousPage()" [disabled]="firstPage">Page précédente</button>
  <h2>Page {{pageIndex+1}} / {{pageNumber}}</h2>
  <button (click)="nextPage()" [disabled]="lastPage">Page suivante</button>
</div>

<span *ngIf="storyBookLoaded && iscurrStorySet" id="fullStory_{{ index }}">
  <div class="card">
    <h2>
      Fifi et Rhino vont {{ currStory.location }} pour
      {{ currStory.purpose }}
      <span *ngIf="currStory?.companion">avec {{ currStory.companion }}</span>
    </h2>
    <p>
    <span *ngFor="let word of currWordArray; let k = index" [ngClass]="{'highlight':highlights[k]}">{{word}} <span *ngIf="currWordArray[k].includes('.')" ><br></span></span>
    </p>
  </div>
  <div class="card">
    <div *ngIf="imagechanging" id="loading"></div>
    <img
      class="standalone"
      *ngIf="!imagechanging"
      src="{{ currStory.image }}"
      width="512"
      height="512"
    />
    <img
      class="standalone"
      *ngIf="isModified[index] && oldimage[index]"
      src="{{ oldimage[index] }}"
      width="512"
      height="512"
    />

    <audio #player src="{{currStory.audio}}"></audio>
    <div>  
    <span class="menu" *ngIf="currStory.audio && !isModified[index]">
        <button class="play" [disabled]="isAudioStarted || isAudioLoading" (click)="playerPlay()"><img src="assets/{{soundStatus}}.png" width="24" height="24"><div *ngIf="isAudioLoading" id="small_loading"></div></button>
        <button class="pause" [disabled]="!isAudioPlaying && !isAudioStarted" (click)="playerPause()"><img src="assets/{{playStatus}}.png" width="24" height="24"></button>
        <button class="stop" [disabled]="!isAudioStarted" (click)="playerStop()"><img src="assets/stop.png" width="24" height="24"></button>
        </span>
        <label>Vitesse de lecture : x{{ readingRate /10 }}</label>
        <input
          type="range"
          min="5"
          max="20"
          value="10"
          class="slider"
          id="myRange"
          name="readingrate"
          [(ngModel)]="readingRate"
        />
      </div>
        <button
      *ngIf="admin"
      [disabled]="imagechanging"
      (click)="changeImage(index)"
    >
      Modifier l'image
    </button>
    <button *ngIf="isModified[index] && admin" (click)="saveStories()">
      Enregistrer la modification
    </button>
    <button *ngIf="isModified[index] && admin" (click)="cancel(index)">
      Annuler la modification
    </button>
    <span class="menu" *ngIf="!hasAudio[index]  || !hasSpeechMarks[index] || isModified[index]">
    <button class="play" *ngIf="admin && (!hasAudio[index] || !hasSpeechMarks[index] || isModified[index])" [disabled]="isAudioPlaying || isAudioLoading" (click)="testSpeech(currStory.text, index)"><span class="menu"><img src="assets/{{soundStatus}}.png" width="24" height="24"><div *ngIf="isAudioLoading" id="small_loading"></div></span></button>
    <button class="pause" *ngIf="admin && (!hasAudio[index] || !hasSpeechMarks[index]|| isModified[index])" [disabled]="!isAudioPlaying" (click)="audioPause()"><img src="assets/{{playStatus}}.png" width="24" height="24"></button>
    <button class="stop" *ngIf="admin && (!hasAudio[index] || !hasSpeechMarks[index] || isModified[index])" [disabled]="!isAudioPlaying" (click)="audioStop()"><img src="assets/stop.png" width="24" height="24"></button>
    </span>
  </div>

  <div class="card">
    <span class="menu">
      <a alt="première histoire" class="nav" (click)="firstStory()"><<</a
      ><a alt="histoire précédente" class="nav" (click)="previousStory()"><</a>
      <p class="nav">{{ message }}</p>
      <a alt="histoire suivante" class="nav" (click)="nextStory()">></a
      ><a alt="dernière histoire" class="nav" (click)="lastStory()">>></a>
    </span>
    <button (click)="randomStory()">Histoire au hasard</button>
  </div>
</span>

<div *ngIf="login" class="card">
  <p>Connecté en tant que : {{ login }}</p>
  <button class="delete" (click)="logout()">Logout</button>
</div>
